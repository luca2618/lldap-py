services:
      lldap:
        image: lldap/lldap:stable
        ports:
          - 3890:3890
          - 17170:17170
        environment:
          UID: 1000
          GID: 1000
          LLDAP_JWT_SECRET: test-secret-key
          LLDAP_KEY_SEED: test-seed-key
          LLDAP_LDAP_USER_PASS: password
        volumes: []
        healthcheck:
          test: ["CMD", "curl", "-f", "http://localhost:17170"]
          interval: 10s
          timeout: 5s
          retries: 5
      lldap-secure:
        image: lldap/lldap:stable
        ports:
          - 6360:6360
        environment:
          UID: 1000
          GID: 1000
          LLDAP_JWT_SECRET: test-secret-key
          LLDAP_KEY_SEED: test-seed-key
          LLDAP_LDAP_USER_PASS: password
          LLDAP_LDAPS_OPTIONS__ENABLED: "true"
          LLDAP_LDAPS_OPTIONS__CERT_FILE: /etc/ssl/certs/lldap.crt
          LLDAP_LDAPS_OPTIONS__KEY_FILE: /etc/ssl/certs/lldap.key
        volumes:
          - ./certs/lldap.crt:/etc/ssl/certs/lldap.crt:ro
          - ./certs/lldap.key:/etc/ssl/certs/lldap.key:ro
        healthcheck:
          test: ["CMD", "curl", "-k", "-f", "http://localhost:17170"]
          interval: 10s
          timeout: 5s
          retries: 5
      
      lldap-https-proxy:
        image: nginx:latest
        ports:
          - 443:443
          - 80:80
        depends_on:
          lldap:
            condition: service_healthy
          lldap-secure:
            condition: service_healthy
        volumes:
          - ./nginx.conf:/etc/nginx/nginx.conf:ro
          - ./certs/proxy.crt:/tmp/proxy.crt:ro
          - ./certs/proxy.key:/tmp/proxy.key:ro
        healthcheck:
          test: ["CMD", "curl", "-k", "-f", "https://localhost/health"]
          interval: 10s
          timeout: 5s
          retries: 5
